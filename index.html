<!DOCTYPE html>
<html lang="ja">

<meta charset="UTF-8">
<title>テトリス制作</title>
<body>
<canvas id = "can"></canvas>
<script>

    const field_Col = 10;
    const field_Row = 20;
    //フィールドサイズ（10*20マス）

    const block_Size = 30;
    //ブロックのサイズを決定（ピクセル）

    const screen_w = block_Size * field_Col;
    const screen_h = block_Size * field_Row;
    //キャンパスサイズ

    const tetro_Size = 4;
    //テトロミノのサイズ(4*4マス)

    let can = document.getElementById("can");
    let con = can.getContext("2d");

    can.width = screen_w;
    can.height = screen_h;
    can.style.border = "3px solid #555"
    //キャンパスの大きさを定義

    let tetoro = [
        [0,0,0,0],
        [1,1,0,0],
        [0,1,1,0],
        [0,0,0,0],
    ];
    let tetoro_x = 0;
    let tetoro_y = 0;

    let field = [];
    for (let y = 0; y < field_Row; y++) {
        field[y] = []
        for (let x = 0; x < field_Col; x++) {
            field[y][x] = 0;
        }
    }
    //初期化関数

    function drawBlock(x,y){
        let px =  x * block_Size;
        let py =  y * block_Size;

        con.fillStyle = "red";
        con.fillRect(px, py, block_Size, block_Size);
        con.stackStyle = "black";
        con.strokeRect(px, py, block_Size, block_Size);
    }
    //１ブロックを表示する関数

    function drawfield() {

        con.clearRect(0, 0, screen_w, screen_h)

        for (let y = 0; y < field_Row; y++) {
            for (let x = 0; x < field_Col; x++) {
                if (field[y][x]) {
                    drawBlock(x, y)
                }
            }
        }
    }
    //フィールドを表示する

    function drawtetoro() {

        for (let y = 0; y < tetro_Size; y++) {
            for (let x = 0; x < tetro_Size; x++) {
                if (tetoro[y][x]) {
                    drawBlock(tetoro_x + x, tetoro_y + y);
                }
            }
        }
    }

   function check (mx,my) {
        for (let y = 0; y < tetro_Size; y++) {
            for (let x = 0; x < tetro_Size; x++) {
                let nx = tetoro_x + mx + x;
                let ny = tetoro_y + my + y;
                if (tetoro[y][x]) {
                    if (field[nx][ny] ||
                        ny < 0 ||
                        nx < 0 ||
                        ny >= field_Row ||
                        nx >= field_Col
                        ) {
                        return false;
                    }
                }
            }
        }
        return true;
    }
    //あたり判定

    drawfield();
    drawtetoro();
   document.body.addEventListener("keydown",(event) => {
        switch (event.code) {
            case "KeyW":
                if(check(0,-1)){
                    tetoro_y--;
                }
                break;
            case "KeyS":
                if(check(0,1)){
                    tetoro_y++;
               }
                break;
            case "KeyA":
                if(check(-1,0)){
                    tetoro_x--;
                }
                break;
            case "KeyD":
                if(check(1,0)){
                    tetoro_x++;
                }
                break;
            case "Space":
                break;
        }

        drawfield();
        drawtetoro();
    });



</script>



</body>
</html>
